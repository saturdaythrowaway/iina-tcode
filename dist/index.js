(()=>{let{core:e,console:t,file:l,mpv:a,utils:o,http:s,event:i,overlay:r,preferences:d}=iina,c="0.0.5",n=()=>{let e="info";"dev"===c&&(e="debug"),o.exec("killall",[`tcode-player-${c}`]).then(()=>{o.exec(`@data/tcode-player-${c}`,["--logfile","/tmp/tcode-player.log","--loglevel",e,"listen","&"])})};if(l.exists("@data/tcode-player-dev")&&(c="dev"),l.exists(`@data/tcode-player-${c}`))t.log("tcode-player already exists"),n();else{t.log("Downloading tcode-player...");let e=o.resolvePath("@data/");l.list(e,{includeSubDir:!1}).forEach(e=>{e.filename.startsWith("tcode-player-")&&l.delete("@data/"+e.filename)}),s.download("https://github.com/saturdaythrowaway/iina-tcode/releases/latest/download/tcode-player",`@data/tcode-player-${c}`).finally(async()=>{await o.exec("chmod",["a+x",o.resolvePath(`@data/tcode-player-${c}`)]),await n()})}let p=s.xmlrpc("http://localhost:6800/xmlrpc"),f=e.status.position;function u(e,t=300){let l;return(...a)=>{clearTimeout(l),l=setTimeout(()=>{e.apply(this,a)},t)}}let g=u(()=>{t.log("play"),p.call("play",["seek",`${e.status.position||0}s`])}),y=u(()=>{t.log("pause"),p.call("pause",["seek",`${e.status.position||0}s`])});i.on("iina.file-loaded",()=>{let l=decodeURIComponent(e.getRecentDocuments()[0].url);t.log(l),l.startsWith("file://")&&(l=l.slice(7),t.log("load"),p.call("load",["filename",l]).then(l=>{e.osd(l),t.log(l)}))}),i.on("iina.window-will-close",()=>{e.osd("closing"),t.log("close"),p.call("close",[])});let m=!1;setInterval(()=>{m&&e.status.paused?(y(),m=!1):m||e.status.paused||(g(),m=!0),e.status.position&&e.status.position!==f&&(p.call("set",["min",`${d.get("min")}`,"max",`${d.get("max")}`,"offset",`${d.get("offset")}ms`,"preferAlt",`${d.get("preferAlt")?"true":"false"}`,"preferSoft",`${d.get("preferSoft")?"true":"false"}`,"preferHard",`${d.get("preferHard")?"true":"false"}`]),p.call("seek",["seek",`${e.status.position||0}s`]),f=e.status.position)},1e3/60)})();
//# sourceMappingURL=index.js.map
