(()=>{let{core:e,console:t,file:l,mpv:o,utils:s,http:a,event:i,overlay:n,preferences:p}=iina;l.exists("@data/tcode-player")?s.exec("@data/tcode-player",["--logfile","/tmp/tcode-player.log","listen","&"]):(t.log("Downloading tcode-player..."),a.download("https://github.com/saturdaythrowaway/iina-tcode","@data/tcode-player"));let c=a.xmlrpc("http://localhost:6800/xmlrpc"),d=e.status.position;function r(e,t=300){let l;return(...o)=>{clearTimeout(l),l=setTimeout(()=>{e.apply(this,o)},t)}}let u=r(()=>{c.call("play",["seek",`${e.status.position}s`])}),m=r(()=>{c.call("pause",["seek",`${e.status.position}s`])});i.on("mpv.unpause",u),i.on("mpv.pause",m),i.on("iina.file-loaded",()=>{let l=decodeURIComponent(e.getRecentDocuments()[0].url).split("/").slice(0,-1).join("/");l.startsWith("file://")?(l=l.slice(7),c.call("load",["folder",l]),c.call("play",["seek","0ms"])):t.log(`dir: ${l}`)}),i.on("iina.window-will-close",()=>{e.osd("closing"),c.call("close",[])}),setInterval(()=>{e.status.position&&e.status.position!==d&&(c.call("seek",["seek",`${e.status.position}s`]),d=e.status.position)},1e3/60)})();
//# sourceMappingURL=index.js.map
