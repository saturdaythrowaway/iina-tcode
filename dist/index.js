(()=>{let{core:e,console:t,file:l,mpv:a,utils:o,http:s,event:i,overlay:n,standaloneWindow:r,preferences:d}=iina,c="0.0.7",p=async()=>{let e="info";"dev"===c&&(e="debug"),await o.exec("killall",[`tcode-player-${c}`]).then(()=>{o.exec(`@data/tcode-player-${c}`,["--logfile","/tmp/tcode-player.log","--loglevel",e,"listen","&"])})};if(l.exists("@data/tcode-player-dev"))c="dev",p();else if(l.exists(`@data/tcode-player-${c}`))p(),t.log("tcode-player already exists");else{t.log("Downloading tcode-player...");let e=o.resolvePath("@data/");l.list(e,{includeSubDir:!1}).forEach(e=>{e.filename.startsWith("tcode-player-")&&l.delete("@data/"+e.filename)}),s.download("https://github.com/saturdaythrowaway/iina-tcode/releases/latest/download/tcode-player",`@data/tcode-player-${c}`).finally(async()=>{await o.exec("chmod",["a+x",o.resolvePath(`@data/tcode-player-${c}`)])}),p()}let f=s.xmlrpc("http://localhost:6800/xmlrpc"),u=e.status.position;function g(e,t=300){let l;return(...a)=>{clearTimeout(l),l=setTimeout(()=>{e.apply(this,a)},t)}}let y=g(()=>{t.log("play"),f.call("play",["seek",`${e.status.position||0}s`])}),m=g(()=>{t.log("pause"),f.call("pause",["seek",`${e.status.position||0}s`])});i.on("iina.file-loaded",async()=>{let l=decodeURIComponent(e.getRecentDocuments()[0].url);t.log(l),l.startsWith("file://")&&(l=l.slice(7),t.log("load"),f.call("load",["filename",encodeURIComponent(l)]).then(l=>{e.osd(l),t.log(l)}))}),i.on("iina.window-will-close",()=>{e.osd("closing"),t.log("close"),f.call("close",[])});let h=!1;setInterval(()=>{h&&e.status.paused?(m(),h=!1):h||e.status.paused||(y(),h=!0),e.status.position&&e.status.position!==u&&(f.call("seek",["seek",`${e.status.position||0}s`]),u=e.status.position)},1e3/60),setInterval(()=>{f.call("set",["min",`${d.get("min")}`,"max",`${d.get("max")}`,"offset",`${d.get("offset")}ms`,"preferAlt",`${d.get("preferAlt")?"true":"false"}`,"preferSoft",`${d.get("preferSoft")?"true":"false"}`,"preferHard",`${d.get("preferHard")?"true":"false"}`])},2e3)})();
//# sourceMappingURL=index.js.map
